<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excellence in Digital Innovation | InnoCellence</title>
<link href="blog.innocellence.com/rss/" rel="alternate" type="application/rss+xml" title="InnoCellence Feed" />
<link rel="stylesheet" type="text/css" href="/static/css/syntax.css">
<link rel="stylesheet" type="text/css" href="/static/css/style.css">

<script src="/static/js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="/static/js/scripts.js"></script>

<link rel="shortcut icon" href="/static/img/favicon.ico">


<link href="/static/css/buttons.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="/static/bootstrap-3.3.7/docs/dist/css/bootstrap.min.css">
<link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
<link href="http://cdn.bootcss.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

<script src="/static/bootstrap-3.3.7/docs/dist/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/static/js/buttons.js"></script>
<script type="text/javascript" src="/static/js/jquery.pin.js"></script>

<style>
     .ondisplay{
       display:inline;
       text-align:center;
     }
     .offdisplay{
         display:none;
     }
     
     .bluelabel{
         color:blue;
     }
    td,th{
        text-align:left;
        white-space: nowrap;
    }
     
    select{
   background-color:white;
   height:40px;
   border-radius:5px;
   box-shadow: 0 0 5px #ccc;
   position: relative;
   box-shadow: 0 0 5px #ccc;
   width: 15%;
   height: 40px;
   margin-top:150px;
   margin-left:20px;
}


    .develop{
        background-color:#FF4500;
        font-weight:bold;
    }
    
    .test{
        background-color:#0000CD;
        font-weight:bold;
    }
    
    .product{
        background-color:#00FF00;
        font-weight:bold;
    }
    


     
</style>

</head>

{% include 'head.html' %}

<body>

{% block content %}
<div class="container1" align="center">
    
    <div style="width:50%; height:120px;" id="box" align="center" class="search" >
        <input type="text" id="keywords" border="1" style="background-color:#E6E6E6;" name="search" placeholder="请输入表名称/作业名称"><span id="search_table" style="float:center;" class="btn btn-lg button-action">&nbsp;&nbsp;&nbsp;表级搜索&nbsp;&nbsp;&nbsp;</span>
        <span id="search_field" style="float:center;" class="btn btn-lg button-action">&nbsp;&nbsp;&nbsp;字段级搜索&nbsp;&nbsp;&nbsp;</span>
    </div>

        <h1 id="searchkeywords" style="display:none">{{ keyword }}</h1>
        
     <label for="name" style="display:none">表状态选择: </label>

      <select id="table_state_flag" style="display:none" class="button">
        <option value='-1' selected>所有</option>
        <option value="开发中">开发中</option>
        <option value="测试中">测试中</option>
        <option value="已上线" >已上线</option>
        <option value="已下线">已下线</option>
        <option value="其他">其他</option>
      </select>
    <div style="width:90%;">

      
       <label for="name" style="" class="">数据库: </label>
       
      <select id="database_id" style="" class="button">
         <option value="-1" selected>数据库库选择</option>
         {% for database in databases %}
             {% if database.id == db_id %}
                <option value="{{ database.id }}" selected>{{ database.db_name }}</option>
             {% else %}
                <option value="{{ database.id }}" >{{ database.db_name }}</option>
             {% endif %}
        
         {% endfor %}
      </select>
      
      
      <label for="name" style="display:none" class="btn btn-primary">主题域: </label>
      <label id='' for="name" style="">主题域: </label>
      <select id="theme" style="" class="button">
         <option value="-1" selected >主题域选择</option>
         {% for theme in themes %}
             {% if theme.id == table_theme_id %}
                <option value="{{ theme.id }}" selected>{{ theme.table_theme_cn_name }}</option>
             {% else %}
                <option value="{{ theme.id }}" >{{ theme.table_theme_cn_name }}</option>
             {% endif %}
         {% endfor %}
      </select>
      
       <label for="name" style="display:none" class="btn btn-primary">业务线: </label>
       
      <select id="" style="display:none" class="button">
         <option value="-1" selected>业务线选择</option>
         {% for businessline in businesslines %}
          
          <option value="{{ businessline.id }}" >{{ businessline.business_line_cn_name }}</option>
           
         {% endfor %}
      </select>
      
        <label for="name" style="display:none" class="btn btn-primary">层次结构: </label>
        
       
        <label for="name" style="">层次结构: </label>
      <select id="tablelevel" style="" class="button">
         <option value="-1" selected>层次结构选择</option>
         {% for tablelevel in tablelevels %}
           {% if tablelevel.id == table_level_id %}
               <option value="{{ tablelevel.id }}" selected>{{ tablelevel.table_level_cn_name }}</option>
           {% else %}
               <option value="{{ tablelevel.id }}" >{{ tablelevel.table_level_cn_name }}</option>
           {% endif %}
         {% endfor %}
      </select>



        <label for="name" style="">是否生效: </label>

      <select id="eff_flag" style="" class="button">

          {% if  eff_flag == 0 %}
            <option value='-1'>是否生效</option>
            <option value="1">生效</option>
            <option value="0" selected>失效</option>
          {% elif eff_flag == 1 %}
            <option value='-1'>是否生效</option>
            <option value="1" selected>生效</option>
            <option value="0">失效</option>
          {% else %}
            <option value='-1' selected>是否生效</option>
            <option value="1">生效</option>
            <option value="0">失效</option>
          {% endif %}
      </select>


    <span id="search_chose" style="float:center;" class="btn btn-lg button-action">&nbsp;&nbsp;&nbsp;筛选&nbsp;&nbsp;&nbsp;</span>

    </div>

    <h1>查询共计：{{table_cnt}} 张表</h1>
   <table id="fieldstable" class="table table-bordered table-striped" style="width:95%" align="center">
  <thead>
    <tr>
        <th width="90px">序号</th>
        <th width="140px">数据库名称</th>
        <th width="30%">表名称</th>
        <th width="30%">表中文解释</th>
        <th width="80px">依赖关系</th>
        <th width="">标签</th>
        <th width="100px">操作</th>
    </tr>
  </thead>
  <tbody>
  {% for table in contacts %}
    <tr>
        <td><a href="/admin/integ_model/table/{{ table.id }}/change/" target="_blank"><span class="button label label-success">{{ forloop.counter }}--{{ table.db_name_id.db_type.db_type_name }}</span></a></td>

        <td>{{ table.db_name_id.db_name }}<span class='offdisplay'>.{{ table.tb_name }}</span></td>

      <td><a href="/fields/tb_id={{ table.id }}"><b>{{ table.tb_name }}</b></a></td>

      <td><b><a href="/fields/tb_id={{ table.id }}">{{ table.tb_cn_name }}</a></b></td>
      
      <td>
      <span class="label label-warning button-tiny"><a style="color:white" href="/tabledependency/tb_id={{ table.id }}" target="_blank" >依赖关系</a></span>

          <span class="label label-info button-tiny" style="display:none"><a style="color:white" href="/">后置表>></a></span>
      </td>
      
      <td class="">
          <span>{{ table.table_level }}</span>
          <p class="" style="display:none">
            <span class="label label-primary">
           {% if table.partition_flag == '1' %}
               分区
            {% elif  table.partition_flag == '0' %}
               非分区
            {% else %}
               
           {% endif %}
           <span>|</span>
           {% if table.sd_flag == '1' %}
               全量
            {% elif  table.sd_flag == '0' %}
               增量
            {% else %}
                 
           {% endif %}
            <span>|</span>
            {% if table.manage_external_flag == '1' %}
               外部
            {% elif  table.manage_external_flag == '0' %}
               管理
            {% else %}
                 
           {% endif %}
          
           <span style="display:none">{{ table.state_flag }}</span>
           <span>|</span>
           {{ table.table_level }}
           <span>|</span>
           {{ table.table_theme }}
            </span>
          </p>
      </td>
        <td>
            <span class="button label label-warning" style=""><a style="color:black;" href="/admin/integ_model/table/{{ table.id }}/change/" target="_blank" >编辑</a></span>
            <span class="button label label-warning" style=""><a style="color:black;" href="/admin/integ_model/table/{{ table.id }}/change/" target="_blank" >下线</a></span>
        </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

    <nav aria-label="Page navigation">
  <ul class="pagination">
       <li>
              <a href="?keyword={{keyword}}&db_id={{db_id}}&state_flag={{state_flag}}&table_theme_id={{table_theme_id}}&table_level_id={{table_level_id}}&page=1&eff_flag={{eff_flag}}" aria-label="Previous">
                <span aria-hidden="true">首页</span>
              </a>
          </li>
      {% if contacts.has_previous %}
          <li>
              <a href="?keyword={{keyword}}&db_id={{db_id}}&state_flag={{state_flag}}&table_theme_id={{table_theme_id}}&table_level_id={{table_level_id}}&page={{ contacts.previous_page_number }}&eff_flag={{eff_flag}}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
          </li>
      {% endif %}

    {%  for pg in pageRange %}
       {% if  contacts.number == pg %}
           <li class="active" ><a href="?keyword={{keyword}}&db_id={{db_id}}&state_flag={{state_flag}}&table_theme_id={{table_theme_id}}&table_level_id={{table_level_id}}&page={{pg}}&eff_flag={{eff_flag}}" aria-label="pg"> {{ pg }}</a></li>
       {% else %}
           <li><a href="?keyword={{keyword}}&db_id={{db_id}}&state_flag={{state_flag}}&table_theme_id={{table_theme_id}}&table_level_id={{table_level_id}}&page={{ pg }}&eff_flag={{eff_flag}}" aria-label="pg"> {{ pg }}</a></li>
       {% endif %}
    {% endfor %}

    {% if contacts.has_next %}
        <li>
          <a href="?keyword={{keyword}}&db_id={{db_id}}&state_flag={{state_flag}}&table_theme_id={{table_theme_id}}&table_level_id={{table_level_id}}&page={{ contacts.next_page_number }}&eff_flag={{eff_flag}}" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
          </a>
        </li>
        {% endif %}
       <li>
              <a href="?keyword={{keyword}}&db_id={{db_id}}&state_flag={{state_flag}}&table_theme_id={{table_theme_id}}&table_level_id={{table_level_id}}&page={{ contacts.paginator.num_pages }}&eff_flag={{eff_flag}}" aria-label="Previous">
                <span aria-hidden="true">尾页</span>
              </a>
      </li>
  </ul>
</nav>


</div>
{% endblock %}
</body>
{% include 'foot.html' %}
</html>


<script type="text/javascript" src='/static/Highcharts-6.0.2/code/highcharts.js'></script>
<script type="text/javascript" src='/static/Highcharts-6.0.2/code/highcharts.src.js'></script>
<script type="text/javascript" src='/static/Highcharts-6.0.2/code/highcharts-3d.js'></script>
<script type="text/javascript" src='/static/Highcharts-6.0.2/code/highcharts-more.js'></script>
<script type="text/javascript" src='/static/Highcharts-6.0.2/code/highcharts-3d.src.js'></script>
<script type="text/javascript" src='/static/Highcharts-6.0.2/code/modules/exporting.js'></script>
<script type="text/javascript" src='/static/Highcharts-6.0.2/code/highcharts-more.src.js'></script>
<script type="text/javascript" src="/static/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/static/js/wordcloud.js"></script>
<script type="text/javascript" src="/static/js/simple-calendar.js"></script>
<script type="text/javascript" src="/static/js/jquery.pin.js"></script>

<script type="text/javascript">
$(document).ready(function(){
    //alert("table");

    //alert({{eff_flag}});

//查询数据库列表
var db_name = $("#db_name").text();

$("table").delegate("td","dblclick",function(){
    //$(this).slideToggle();
    var value = $(this).text();
    var textarea = document.createElement("textarea");
    var currentFocus = document.activeElement;
    textarea.value = value.replace("|编辑","");
    document.body.appendChild(textarea);
    textarea.select();
    var flag = document.execCommand("copy");
    //textarea.focus();
    alert("复制 "+textarea.value+"  成功");
    document.body.removeChild(textarea);
});

$("#fieldstable").on("click","tr td a", function() {
         //alert("OK");
         //获取数据库名称
         //dbname = $("#fieldstable tr").eq(i+1).children('td').eq(1).children('input').val();
         //$(this).parent().parent().remove();
         //db_table = $(this).parent().parent().children('td').eq(1).text();

         //alert(db_table);
         //window.location.href="/fields/db_table="+db_table;

    });

function reflash_table(){

 //获取选择的数据库ID
     table_state_flag = $('#table_state_flag option:selected').val();//选中的值
     //alert(table_state_flag);
    //遍历表
    //var table = document.getElementById("fieldstable");
    $("#fieldstable tbody").find("tr").each(function(){
        var cur_table_state_flag = $(this).children('td').eq(7).text();
        
        //alert(cur_table_state_flag);
        if(table_state_flag == cur_table_state_flag && table_state_flag != "所有"){
           //alert("选中显示");
           $(this).show();

        }else if(table_state_flag != cur_table_state_flag && table_state_flag != "所有"){
           //其他隐藏
           //alert("选中隐藏");
           $(this).hide();

           //$(this).parent().parent().removeClass("");
           //$(this).parent().parent().addClass("");
        }else if (table_state_flag == "所有"){
            $(this).show();
            if(cur_table_state_flag == "开发中"){
               $(this).children('td').eq(7).children('button').addClass("develop");
               $(this).children('td').eq(7).children('button').removeClass("test");
               $(this).children('td').eq(7).children('button').removeClass("product");
               
            }else if(cur_table_state_flag == "测试中"){
                $(this).children('td').eq(7).children('button').addClass("test");
                $(this).children('td').eq(7).children('button').removeClass("develop");
                $(this).children('td').eq(7).children('button').removeClass("product");
                
            }else if(cur_table_state_flag == "已上线"){
                $(this).children('td').eq(7).children('button').addClass("product");
                $(this).children('td').eq(7).children('button').removeClass("test");
                $(this).children('td').eq(7).children('button').removeClass("develop");
                
            }
        }
    });

}
    
//选择数据库
//$("#table_state_flag").change(function(){
//    reflash_table();
//});

//reflash_table();

function showTable()
{
 alert("OK");
}

//主题选择
$("#theme").change(function(){
     theme_id = $('#theme option:selected').val();//选中的值
     //alert(theme_id);
     if(theme_id != -1){
        //alert("start");
     }
});

//层次结构
$("#tablelevel").change(function(){
     tablelevel_id = $('#tablelevel option:selected').val();//选中的值
     //alert(tablelevel_id);
     if(tablelevel_id != -1){
        //alert("start");
        
        
     }
});



var keyword = $("#searchkeywords").text();
//alert(keyword);

if (keyword !== null || keyword !== undefined || keyword !== '') { 
  
   $("#keywords").val(keyword);
   
}


//点击搜索表按钮
$("#search_table").on("click", function() {
        
        //获取数据库类型id
        keywords = $("#keywords").val();
        //alert(keywords);
        //获取是否有效标志id
        //eff_flag_id = $("#db_eff_flag").find("option:selected").val();
        //alert(db_type_id+":"+eff_flag_id);
        //window.open('/model/?db_type='+db_type_id+'&eff_flag='+eff_flag_id,'_self');
        window.open("/searchtableresult/?keyword="+keywords,'_self');
        //window.open("https://www.baidu.com/s?word="+keywords);
});


//点击搜索字段按钮
$("#search_field").on("click", function() {
        //获取数据库类型id
        keywords = $("#keywords").val();
        //alert(keywords);
        //获取是否有效标志id
        //eff_flag_id = $("#db_eff_flag").find("option:selected").val();
        //alert(db_type_id+":"+eff_flag_id);
        //window.open('/model/?db_type='+db_type_id+'&eff_flag='+eff_flag_id,'_self');
        window.open("/searchfieldresult/?keyword="+keywords,'_self');
        //window.open("https://www.baidu.com/s?word="+keywords);
});


//点击搜索按钮
$("#search_chose").on("click", function() {
        
        //获取数据库类型id
        keywords = $("#keywords").val();
        //alert(keywords);
        //获取是否有效标志id
        //eff_flag_id = $("#db_eff_flag").find("option:selected").val();
        //alert(db_type_id+":"+eff_flag_id);
        //window.open('/model/?db_type='+db_type_id+'&eff_flag='+eff_flag_id,'_self');
        //window.open("/searchtableresult/?keyword="+keywords,'_self');
        //window.open("https://www.baidu.com/s?word="+keywords);
        
        //获取表状态
        state_flag = $('#table_state_flag option:selected').val();//选中的值
        
        
        //获取数据库
        database_id = $('#database_id option:selected').val();//选中的值
        
        //获取主题域
        table_theme_id = $('#theme option:selected').val();//选中的值
        
        //获取层次结构
        table_level_id = $('#tablelevel option:selected').val();//选中的值

        //获取是否生效
        eff_flag = $('#eff_flag option:selected').val();//选中的值
        
        
        //alert(state_flag+"ok"+table_theme_id+"-"+table_level_id);
        
        ///searchtableresult/?keyword=1&state_flag=1&table_theme_id=1&table_level_id=1
        url = "/searchtableresult/?keyword="+keywords+'&db_id='+database_id+'&state_flag='+state_flag+"&table_theme_id="+table_theme_id+"&table_level_id="+table_level_id+"&eff_flag="+eff_flag;
        
        //alert(url);
        window.open(url,'_self');
        //window.open("/searchtableresult/?keyword="+keywords,'_self');
});



});
</script>

</html>
